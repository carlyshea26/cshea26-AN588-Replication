---
title: "Replication Assignment Carly"
author: "Carly S McDermott"
date: "2025-03-21"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Loading Required Packages
```{r}
library(ggplot2)
library(dplyr)
library(datasets)
library(RColorBrewer)
library(ggplot2)
library(tibble)
library(ggpubr)
library(gridExtra)
library(FSA)
library(ggthemes)
if (!require("gplots", quietly = TRUE)) {
  install.packages("gplots", dependencies = TRUE)
}
library(gplots)

if (!require("RColorBrewer", quietly = TRUE)) {
  install.packages("RColorBrewer", dependencies = TRUE)
}
library(RColorBrewer)
library (dendextend)
library(grid)
library(gtable)
library(ggprism)
```

Special Case for "gganimate"
```{r}
# in order to install this final package, it's dependent on already having the packages "ggplot2", "gifski", and "transformr" installed (do this first)
install.packages(c("ggplot2", "gifski", "transformr"))
install.packages(gganimate)
library(gganimate)
```

**R was not used to generate figure 1A for the paper, so I am inserting it here**
![Figure 1A] 

Data Time: 

Loading CSV File Used for Figure 1C: 
Summary of file INI_ave_see_99_05.csv
- contains all INIs(inter-note-intervals) averaged by song collected from 1999 to 2005 at the SE location of the ONA region (Figure 1C in paper). Column headers listed below:

-  "date"-  day of the analysed song
-  "Ave_INI"-averaged INIs by song and day
-  "SD_INI"- standard deviation for INIs by song and day
-  "Ave_PF"- averaged peak frequencies of  20-Hz notes by song and day
-  "SD_PF"-standard deviation of peak frequencies of 20-Hz notes by song and day
-  "Num_INI"-number of INIs measured

```{r}
bout9905<-read.csv(file="~/Desktop/DATA/INI_ave_SE_99_05.csv", header=TRUE, dec=".")
bout9905$date <- as.Date(bout9905$date, format = "%d/%m/%Y")
str(bout9905$date)  # ensuring we now have the date format
head(bout9905$date)
```

```{r}
ini_b_9905 <- ggplot(bout9905, aes(x = date, y = Ave_INI)) +
  geom_point(size=2, aes(group=1), color="darkblue")+
  geom_errorbar(aes(ymin=Ave_INI-SD_INI, ymax=Ave_INI+SD_INI),width=2, color="darkblue") +
  scale_y_continuous(name = "Average song INI (s)",
                     limits=c(9, 20), guide = guide_prism_minor()) + theme_bw() +  
  scale_x_date(breaks="6 month", date_labels="%b %y")+
  theme(plot.title = element_text(size = 18, family = "Times", face = "bold"),
        text=element_text(family = "Times"),panel.grid.major.y = element_line(colour="black", linetype=2), 
        panel.grid.minor = element_blank(), panel.grid.major.x = element_line(colour="black", linetype=2), strip.text.x = element_text(size = 18, face="bold", margin = margin(0.5, 0, 0.5, 0, "cm")),
        strip.background = element_rect(fill="grey97"),
        axis.title = element_text(face="bold", size = 28),
        axis.title.x = element_blank(),
        axis.text.x = element_text(colour="black", size = 28, vjust=0.5, angle=90),
        axis.text.y = element_text(colour="black", size = 28), legend.position = "top", 
        legend.text=element_text(size=22), legend.title=element_blank())
print(ini_b_9905)
```
# Figure 1B (Running into an error) [#Fig. 1B ]INI percentage song type in SE location from the ONA region]
```{r}
perc_SE<-read.csv(file="~/Desktop/DATA/Perc_SE_songs.csv", header=TRUE, dec=".")
str(perc_SE)
perc_SE$INI <- factor(perc_SE$INI, levels = c("19s", "Hyb", "12s"))

# "Make sure perc and Rythm are in the correct format" - but this is wrong (Ry)
perc_SE$perc <- as.numeric(perc_SE$perc)
perc_SE$INI <- factor(perc_SE$INI) #no column in the file that has rhythm in it - changed original rythm to INI?

perc<-ggplot(perc_SE, aes(fill=INI, y=perc, x=year)) +
  geom_bar(position="fill", stat="identity", width=0.5) +
  scale_y_continuous(name = "INI type (%)",labels = scales::percent_format())+
  theme_bw() +
  theme(text=element_text(family = "Times"),panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        strip.text.x = element_text(size = 12, face="bold", margin = margin(0.5, 0, 0.5, 0, "cm")),
        strip.background = element_rect(fill="grey97"),
        axis.title = element_text(face="bold", size = 20),
        axis.title.x = element_blank(),
        axis.text.x = element_text(colour="black", size = 20, angle=60, vjust = 0.5, hjust=0.5),
        axis.text.y = element_text(colour="black", size = 20), legend.position = "top", 
        legend.text=element_text(size=20), legend.title=element_blank()) +
  scale_fill_manual(values=c("red","cyan", "springgreen4")) +
#adding annotation for dashed line in 2001/2002 column
  geom_segment(aes(x = which(perc_SE$year == "2001/2002")[1], 
                   xend = which(perc_SE$year == "2001/2002")[1], 
                   y = 0.01, yend = 0.99), 
               linetype = "dashed", color = "black", linewidth = 1.5) +

#adding annotation for "No Data" (attempting to center it)
  annotate("text", x = which(perc_SE$year == "2001/2002")[1], y = 0.5, 
           label = "No Data", family = "Times", angle = 90, vjust = -0.5, hjust = .5, size = 6)
print(perc)
```
#comments regarding figure 1b:
- Researchers tried to run this model using a column title called "perc_SEdollarsignRythm", which does not exist and is not found anywhere else in the above code. I renamed this to the column "perc_SEdollarsignINI", which still properly mirrors the 1B figure in the original paper. I believe this was just a naming mishap that could have arisen from their end 


#Figure 3:
```{r}
bout0620<-read.csv(file="~/Desktop/DATA/INI_ave_06_20.csv", header=TRUE, dec=".")

bout0620$date <-as.Date(bout0620$date, format = "%d/%m/%Y")

ini_b_0620 <- ggplot(bout0620, aes(x = date, y = Ave_INI, color= Region)) +
  geom_point(size=2, aes(group=1))+
  geom_errorbar(aes(ymin=Ave_INI-SD_INI, ymax=Ave_INI+SD_INI),width=30) +
  scale_y_continuous(name = "Average song INI (s)",
                     limits=c(7.8, 21.5), guide = guide_prism_minor()) + 
  theme_bw() +  
  scale_x_date (breaks="1 year", date_labels="%Y")+
  theme(plot.title = element_text(size = 18, family = "Times", face = "bold"),
        text=element_text(family = "Times"),panel.grid.major.y = element_line(colour="black", linetype=2), 
        panel.grid.minor = element_blank(),panel.grid.major.x = element_line(colour="black", linetype=2),
        strip.text.x = element_text(size = 18, face="bold", margin = margin(0.5, 0, 0.5, 0, "cm")),
        strip.background = element_rect(fill="grey97"),
        axis.title.y = element_text(colour="black", size = 20, face="bold"),
        axis.title.x = element_blank(),
        axis.text.x = element_text(colour="black", size = 20, vjust=0.5, angle=90),
        axis.text.y = element_text(colour="black", size = 20), legend.position = "top", 
        legend.text=element_text(size=22), legend.title=element_blank()) +
  scale_color_manual(values=c("darkviolet","darkorange","green4", "black","turquoise","darkblue","red" )) +
  #facet_grid(~year3, scale="free_x")
  stat_smooth( method = "glm",aes(group=1), colour = "black", fill= "grey", size=0.5)

print(ini_b_0620)
```

```{r}
#Fig. 3B: Gradient of the peak frequency of the 20Hz only for EAR data
EARs<-subset(bout0620, Location=="Azores" | Location=="Gorringe")

EARs<-read.csv(file="~/Desktop/DATA/20Hz_ave_EARs.csv", header=TRUE, dec=".")

EARs$date <-as.Date(EARs$date, format = "%d/%m/%Y")
freq20_b_EAR <- ggplot(EARs, aes(x = date, y = Ave_PF, color= Region)) +
  geom_point(size=2, aes(group=1))+
  geom_errorbar(aes(ymin=Ave_PF-SD_PF, ymax=Ave_PF+SD_PF),width=30) +
  scale_y_continuous(name = "20-Hz note peak frequency (Hz)",
                     limits=c(18, 25)) + 
  theme_bw() +  
  scale_x_date (breaks="1 year", date_labels="%Y")+
  theme(plot.title = element_text(size = 18, family = "Times", face = "bold"),
        text=element_text(family = "Times"),panel.grid.major.y = element_line(colour="black", linetype=2), 
        panel.grid.minor = element_blank(),panel.grid.major.x = element_line(colour="black", linetype=2),
        strip.text.x = element_text(size = 18, face="bold", margin = margin(0.5, 0, 0.5, 0, "cm")),
        strip.background = element_rect(fill="grey97"),
        axis.title = element_text(face="bold", size = 28),
        axis.title.x = element_blank(),
        axis.text.x = element_text(colour="black", size = 28, vjust=0.5, angle=90),
        axis.text.y = element_text(colour="black", size = 28), legend.position = "top", 
        legend.text=element_text(size=16), legend.title=element_blank()) +
  scale_color_manual(values=c("red", "darkblue")) +
  stat_smooth(method = "glm",aes(group=1), colour = "black", fill= "grey", size=0.5)
print(freq20_b_EAR)
```
#FIGURE 3C:
```{r}
HF<-read.csv(file="~/Desktop/DATA/HF_ave.csv", header=TRUE, dec=".")

HF$date <-as.Date(HF$date, format = "%d/%m/%Y")

HF_b <- ggplot(HF, aes(x = date, y = Ave_PF, color= Region)) +
  geom_point(size=2, aes(group=1))+
  geom_errorbar(aes(ymin=Ave_PF-SD_PF, ymax=Ave_PF+SD_PF),width=30) +
  scale_y_continuous(name = "HF note peak frequency (Hz)",
                     limits=c(122, 138)) + 
  theme_bw() +  
  scale_x_date(breaks="1 year", date_labels="%Y") +
  theme(plot.title = element_text(size = 18, family = "Times", face = "bold"),
        text=element_text(family = "Times"),panel.grid.major.y = element_line(colour="black", linetype=2),
        panel.grid.minor = element_blank(),panel.grid.major.x = element_line(colour="black", linetype=2),
        strip.text.x = element_text(size = 18, face="bold", margin = margin(0.5, 0, 0.5, 0, "cm")),
        strip.background = element_rect(fill="grey97"),
        axis.title = element_text(face="bold", size = 28),
        axis.title.x = element_blank(),
        axis.text.x = element_text(colour="black", size = 28, vjust=0.5, angle=90),
        axis.text.y = element_text(colour="black", size = 28), legend.position = "top", 
        legend.text=element_text(size=16), legend.title=element_blank()) +
  scale_color_manual(values=c("darkviolet", "red", "green4","black","turquoise", "blue")) +
  #facet_grid(~year2, scale="free_x") 
  stat_smooth(method = "glm",aes(group=1), colour = "black", fill= "grey", lwd=0.5)
HF_b
```

```{r}
#Fig. 3A: Histograms of all INI measurements from the same singing season
ini_all<-read.csv(file="INI_all.csv", header=TRUE, dec=".")

#2006/2007====================================================
ini0607<-subset(ini_all, year2=="2006/2007")

ini0607_g <- ggplot(ini0607, aes(INI, fill=Region)) +
  geom_histogram(color="black", alpha=0.5, bins=50) +
  theme_bw() +  
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        plot.title = element_text(size = 18, family = "Times", face = "bold"),
        text=element_text(family = "Times"),
        axis.title = element_text(face="bold", size = 28),
        axis.title.y = element_blank(),
        axis.title.x=element_blank(),
        axis.text.x = element_text(colour="black", size = 28),
        axis.text.y = element_text(colour="black", size = 28), legend.position = "top", 
        legend.text=element_text(size=28), legend.title=element_blank()) +
  scale_x_continuous(limits=c(6,20)) +
  scale_fill_manual(values=c("turquoise", "darkblue"))
ini0607_g

#2007/2008=============================================================
ini0708<-subset(ini_all, year2=="2007/2008")
ini0708_g <- ggplot(ini0708, aes(INI, fill=Region)) +
  geom_histogram(color="black", alpha=0.5, bins=50) +
  theme_bw() +  
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        plot.title = element_text(size = 18, family = "Times", face = "bold"),
        text=element_text(family = "Times"),
        axis.title = element_text(face="bold", size = 28),
        axis.title.y = element_blank(),
        axis.title.x=element_blank(),
        axis.text.x = element_text(colour="black", size = 28),
        axis.text.y = element_text(colour="black", size = 28), legend.position = "top", 
        legend.text=element_text(size=28), legend.title=element_blank()) +
  scale_x_continuous(limits=c(6,20)) +
  scale_fill_manual(values=c("black", "darkblue","red"))
ini0708_g

#2014/2015=============================================================
ini1415<-subset(ini_all, year2=="2014/2015")
ini1415_g <- ggplot(ini1415, aes(INI, fill=Region)) +
  geom_histogram(color="black", alpha=0.5, bins=30) + 
  theme_bw() +  
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        plot.title = element_text(size = 18, family = "Times", face = "bold"),
        text=element_text(family = "Times"),
        axis.title = element_text(face="bold", size = 28),
        axis.title.y = element_blank(),
        axis.title.x=element_blank(),
        axis.text.x = element_text(colour="black", size = 28),
        axis.text.y = element_text(colour="black", size = 28), legend.position = "top", 
        legend.text=element_text(size=28), legend.title=element_blank()) +
  scale_fill_manual(values=c("darkviolet", "darkorange")) +
  scale_x_continuous(limits=c(6,20)) +
  scale_y_continuous(name = "Count")
ini1415_g

#2015/2016======================================================================
ini1516<-subset(ini_all, year2=="2015/2016")
ini1516_g <- ggplot(ini1516, aes(INI, fill=Region)) +
  geom_histogram(color="black", alpha=0.5, bins=50) +
  theme_bw() +  
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        plot.title = element_text(size = 18, family = "Times", face = "bold"),
        text=element_text(family = "Times"),
        axis.title = element_text(face="bold", size = 28),
        axis.title.y = element_blank(),
        axis.title.x=element_blank(),
        axis.text.x = element_text(colour="black", size = 28, vjust=0.5),
        axis.text.y = element_text(colour="black", size = 28), legend.position = "top", 
        legend.text=element_text(size=28), legend.title=element_blank()) +
  scale_x_continuous(limits=c(6,20)) + 
  scale_fill_manual(values=c("darkviolet", "green4", "red"))
ini1516_g

#2016/2017=========================================================================
ini1617<-subset(ini_all, year2=="2016/2017")
ini1617_g <- ggplot(ini1617, aes(INI, fill=Region)) +
  geom_histogram(color="black", alpha=0.5, bins=50) +
  theme_bw() +  
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        plot.title = element_text(size = 18, family = "Times", face = "bold"),
        text=element_text(family = "Times"),
        axis.title = element_text(face="bold", size = 28),
        axis.title.y = element_blank(),
        axis.title.x=element_blank(),
        axis.text.x = element_text(colour="black", size = 28, vjust=0.5),
        axis.text.y = element_text(colour="black", size = 28), legend.position = "top", 
        legend.text=element_text(size=28), legend.title=element_blank()) +
  scale_x_continuous(limits=c(6,20)) +
  scale_fill_manual(values=c("green4", "darkblue"))
ini1617_g

#2017/2018==========================================================================
ini1718<-subset(ini_all, year2=="2017/2018")
ini1718_g <- ggplot(ini1718, aes(INI, fill=Region)) +
  geom_histogram(color="black", alpha=0.5, bins=50) +
  theme_bw() +  
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        plot.title = element_text(size = 18, family = "Times", face = "bold"),
        text=element_text(family = "Times"),
        axis.title = element_text(face="bold", size = 28),
        axis.title.y = element_blank(),
        axis.title.x=element_blank(),
        axis.text.x = element_text(colour="black", size = 28),
        axis.text.y = element_text(colour="black", size = 28), legend.position = "top", 
        legend.text=element_text(size=28), legend.title=element_blank()) +
  scale_x_continuous(limits=c(6,20)) +
  scale_fill_manual(values=c( "darkviolet", "darkblue"))
ini1718_g

grid.arrange (ini0607_g, ini0708_g, ini1415_g, ini1516_g, ini1617_g, ini1718_g, ncol=2)

#Fig 3B: Histograms of all peak frequencies of the HF note from the same singing season
hf_all<-read.csv(file="HF_all.csv", header=TRUE, dec=".")

#2015/2016======================================================================
hf1516<-subset(hf_all, year_s=="2015/2016")
hf1516_g <- ggplot(hf1516, aes(Peak_Freq, fill=Region)) +
  geom_histogram(color="black", alpha=0.5, bins=18) +
  theme_bw() +  
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        plot.title = element_text(size = 18, family = "Times", face = "bold"),
        text=element_text(family = "Times"),
        axis.title = element_text(face="bold", size = 28),
        axis.title.y = element_blank(),
        axis.title.x=element_blank(),
        axis.text.x = element_text(colour="black", size = 28),
        axis.text.y = element_text(colour="black", size = 28), legend.position = "none", 
        legend.text=element_text(size=28), legend.title=element_blank()) +
  scale_x_continuous(limits=c(120,135)) +
  scale_fill_manual(values=c("darkviolet","red","green4"))
hf1516_g

#2016/2017==========================================================================
hf1617<-subset(hf_all, year_s=="2016/2017")
hf1617_g <- ggplot(hf1617, aes(Peak_Freq, fill=Region)) +
  geom_histogram(color="black", alpha=0.5, bins=15) +
  theme_bw() +  
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        plot.title = element_text(size = 18, family = "Times", face = "bold"),
        text=element_text(family = "Times"),
        axis.title = element_text(face="bold", size = 28),
        axis.title.y = element_blank(),
        axis.title.x=element_blank(),
        axis.text.x = element_text(colour="black", size = 28, vjust=0.5),
        axis.text.y = element_text(colour="black", size = 28), legend.position = "none", 
        legend.text=element_text(size=22), legend.title=element_blank()) +
  scale_x_continuous(limits=c(120,135)) +
  scale_fill_manual(values=c("green4", "blue"))
hf1617_g

#2017/2018=============================================================================
hf1718<-subset(hf_all, year_s=="2017/2018")
hf1718_g <- ggplot(hf1718, aes(Peak_Freq, fill=Region)) +
  geom_histogram(color="black", alpha=0.5, bins=15) +
  theme_bw() +  
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        plot.title = element_text(size = 18, family = "Times", face = "bold"),
        text=element_text(family = "Times"),
        axis.title = element_text(face="bold", size = 28),
        axis.title.y = element_blank(),
        axis.title.x=element_blank(),
        axis.text.x = element_text(colour="black", size = 28, vjust=0.5),
        axis.text.y = element_text(colour="black", size = 28), legend.position = "none", 
        legend.text=element_text(size=22), legend.title=element_blank()) +
  scale_x_continuous(limits=c(120,135)) +
  scale_fill_manual(values=c("darkviolet", "blue"))
hf1718_g

grid.arrange (hf1516_g, hf1617_g, nrow=2)
```


Do supplementary qq plots